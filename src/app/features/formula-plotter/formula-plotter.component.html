<div class="formula-plotter">
    <header class="plotter-header">
        <h3 class="plotter-title">
            <span class="icon">üìê</span>
            F√≥rmulas
            @if (formulaCount() > 0) {
            <span class="count">({{ formulaCount() }})</span>
            }
        </h3>

        <div class="header-actions">
            <button class="btn btn-sm btn-ghost" (click)="addExamples()" title="Adicionar exemplos">
                üìö
            </button>

            @if (formulaCount() > 0) {
            <button class="btn btn-sm btn-ghost btn-danger" (click)="clearAll()" title="Limpar todas">
                üóëÔ∏è
            </button>
            }
        </div>
    </header>

    <div class="formulas-list">
        @for (formula of formulas(); track formula.id; let i = $index) {
        <app-formula-row [formula]="formula" [index]="i" [isFirst]="i === 0" [isLast]="i === formulas().length - 1"
            (remove)="onRemove(formula.id)" (expressionChange)="onExpressionChange(formula.id, $event)"
            (colorChange)="onColorChange(formula.id, $event)" (toggleEnabled)="onToggleEnabled(formula.id)"
            (toggleLocked)="onToggleLocked(formula.id)" (duplicate)="onDuplicate(formula.id)"
            (moveUp)="onMoveUp(formula.id)" (moveDown)="onMoveDown(formula.id)" />
        } @empty {
        <div class="empty-state">
            <p>Nenhuma f√≥rmula adicionada</p>
            <p class="hint">Clique em + para adicionar</p>
        </div>
        }
    </div>

    <footer class="plotter-footer">
        <button class="btn btn-primary btn-add" (click)="addFormula()">
            <span class="icon">+</span>
            Adicionar F√≥rmula
        </button>
    </footer>

    <details class="help-section">
        <summary>üìñ Ajuda - Sintaxe</summary>
        <div class="help-content">
            <section>
                <h4>Operadores</h4>
                <code>+ - * / ^ %</code>
            </section>

            <section>
                <h4>Fun√ß√µes</h4>
                <code>sin cos tan sqrt abs log exp floor ceil round</code>
            </section>

            <section>
                <h4>Constantes</h4>
                <code>PI E TAU PHI</code>
            </section>

            <section>
                <h4>Exemplos</h4>
                <ul>
                    <li>
                        <code class="clickable" (click)="addExampleFormula('x^2')">x^2</code>
                        - Par√°bola
                    </li>
                    <li>
                        <code class="clickable" (click)="addExampleFormula('sin(x)')">sin(x)</code>
                        - Seno
                    </li>
                    <li>
                        <code class="clickable" (click)="addExampleFormula('x * cos(x)')">x * cos(x)</code>
                        - GCU
                    </li>
                    <li>
                        <code class="clickable"
                            (click)="addExampleFormula('1 / (1 + exp(-x))')">1 / (1 + exp(-x))</code>
                        - Sigmoid
                    </li>
                    <li>
                        <code class="clickable" (click)="addExampleFormula('sqrt(abs(x))')">sqrt(abs(x))</code>
                        - Raiz do absoluto
                    </li>
                </ul>
            </section>
        </div>
    </details>
</div>