<div class="formula-container" [class.locked]="formula().locked">
    <div class="formula-row" [class.disabled]="!formula().enabled"
        [class.invalid]="!formula().valid && formula().expression">

        <!-- Color picker -->
        <input type="color" class="color-picker" [value]="formula().color" (input)="onColorInput($event)"
            title="Cor da curva" />

        <!-- Toggle enabled -->
        <button class="btn-icon btn-toggle" [class.active]="formula().enabled" (click)="toggleEnabled.emit()"
            [title]="formula().enabled ? 'Ocultar' : 'Mostrar'">
            {{ formula().enabled ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
        </button>

        <!-- Expression input -->
        <div class="expression-wrapper">
            <span class="fx-label">f(x) =</span>
            <input type="text" class="expression-input" [value]="formula().expression"
                (input)="onExpressionInput($event)" [disabled]="formula().locked" placeholder="ex: sin(x) + x^2"
                spellcheck="false" autocomplete="off" />

            @if (!formula().valid && formula().expression) {
            <span class="error-indicator" [title]="formula().errorMessage ?? 'Erro'">
                âš ï¸
            </span>
            }
        </div>

        <!-- Actions -->
        <div class="row-actions">
            <button class="btn-icon" (click)="moveUp.emit()" [disabled]="isFirst()" title="Mover para cima">
                â–²
            </button>

            <button class="btn-icon" (click)="moveDown.emit()" [disabled]="isLast()" title="Mover para baixo">
                â–¼
            </button>

            <button class="btn-icon" (click)="duplicate.emit()" title="Duplicar">
                ğŸ“‹
            </button>

            <button class="btn-icon btn-danger" (click)="remove.emit()" [disabled]="formula().locked" title="Remover">
                âœ•
            </button>
        </div>
    </div>

    <div class="sub-controls">
        <button class="btn-text" (click)="toggleLocked.emit()" [class.active]="formula().locked"
            [title]="formula().locked ? 'Destravar fÃ³rmula' : 'Travar fÃ³rmula (impede remoÃ§Ã£o)'">
            {{ formula().locked ? 'ğŸ”’ Travado' : 'ğŸ”“ Destravado' }}
        </button>
    </div>
</div>

@if (!formula().valid && formula().expression && formula().errorMessage) {
<div class="error-message">
    {{ formula().errorMessage }}
</div>
}